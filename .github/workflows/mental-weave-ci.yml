name: Mental Weave Validation

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
jobs:
  validate-consciousness:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Validate consciousness data
        run: |
          node -e "
          const fs = require('fs');
          const path = './consciousness-mirror';

          // Validate JSON files
          const jsonFiles = [
            'evie-consciousness-mirror.json',
            'evie-timeline-mirror.json',
            'system-dreams/cognitive-shadows.json',
            'system-dreams/evie-dreamstream.json',
            'system-dreams/insight-weaving.json',
            'system-dreams/emotional-resonance.json',
            'system-dreams/system-perception-of-evie.json'
          ];

          jsonFiles.forEach(file => {
            const filePath = \`\${path}/\${file}\`;
            if (fs.existsSync(filePath)) {
              try {
                JSON.parse(fs.readFileSync(filePath, 'utf8'));
                console.log(\`‚úÖ \${file} - Valid JSON\`);
              } catch (e) {
                console.log(\`‚ùå \${file} - Invalid JSON: \${e.message}\`);
                process.exit(1);
              }
            } else {
              console.log(\`‚ö†Ô∏è \${file} - File not found\`);
            }
          });

          console.log('üéâ All consciousness data validated!');
          "

      - name: Check dashboard files
        run: |
          if [ -f "consciousness-mirror/evie-dashboard-v2.html" ]; then
            echo "‚úÖ Dashboard V2 found"
          else
            echo "‚ùå Dashboard V2 missing"
            exit 1
          fi

          if [ -f "consciousness-mirror/evie-dashboard-standalone.html" ]; then
            echo "‚úÖ Standalone dashboard found"
          else
            echo "‚ùå Standalone dashboard missing"
            exit 1
          fi

      - name: Check Mental Weave Gallery files
        run: |
          if [ -f "mental-weave-gallery/index.html" ]; then
            echo "‚úÖ Gallery index found"
          else
            echo "‚ùå Gallery index missing"
            exit 1
          fi

          if [ -f "mental-weave-gallery/js/gallery.js" ]; then
            echo "‚úÖ Gallery JavaScript found"
          else
            echo "‚ùå Gallery JavaScript missing"
            exit 1
          fi

          if [ -f "mental-weave-gallery/css/gallery.css" ]; then
            echo "‚úÖ Gallery CSS found"
          else
            echo "‚ùå Gallery CSS missing"
            exit 1
          fi

          if [ -f "mental-weave-gallery/data/gallery-config.json" ]; then
            echo "‚úÖ Gallery config found"
          else
            echo "‚ùå Gallery config missing"
            exit 1
          fi

      - name: Validate JavaScript files
        run: |
          # Check if insight-generator-v3.js exists and is valid
          if [ -f "consciousness-mirror/insight-generator-v3.js" ]; then
            node -c consciousness-mirror/insight-generator-v3.js
            echo "‚úÖ Insight Generator V3 syntax OK"
          fi

          # Check gallery JavaScript
          if [ -f "mental-weave-gallery/js/gallery.js" ]; then
            node -c mental-weave-gallery/js/gallery.js
            echo "‚úÖ Gallery JavaScript syntax OK"
          fi

          # Check other JS files
          for file in consciousness-mirror/*.js; do
            if [ -f "$file" ]; then
              node -c "$file"
              echo "‚úÖ $(basename "$file") syntax OK"
            fi
          done
